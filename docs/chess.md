# Описание классов и методов

## Board

Шахматная доска.

Этот класс, как и все остальные, реализует логическое представление доски в
программе, а не её визуальное отображение.

### Атрибуты Board

* **black_king** - чёрный король;
* **black_pieces** - список чёрных фигур, находящихся на доске
(снятые из этого списка исключаются);
* **squares** - [все поля](#squares) доски;
* **white_king** - белый король;
* **white_pieces** - список белых фигур, находящихся на доске
(снятые из этого списка исключаются).

### Методы Board

* **clear()** - убирает все фигуры с доски;
* **put_..._..._at(place)** - ставит фигуру на доску.
Аргумент **place** может быть строкой с координатами поля (например, "c7" или
"G5") либо ссылкой на объект [Square](#square).

## Piece

Базовый класс для шахматных фигур.

### Атрибуты Piece

* **board** - объект класса [Board](#board), доска, которой принадлежит фигура;
* **color** - цвет фигуры;
* **former_squares** - список полей, на которых фигура находилась ранее
(не включает текущее пуле), может быть пуст, если фигура ещё не ходила;
* **moved** - истинен, если фигура совершала ходы после помещения на доску,
иначе ложен;
* **place_at** - ссылка на поле шахматной доски, на котором находится фигура;
если фигура находится вне доски - принимает значение **None**;
* **promoted_from** - - ссылка на другую фигуру (пешку), превращением из
которой была создана данная фигура.

### Конструктор Piece

Аргументы:

1. **board** - объект класса [Board](#board), доска, которой принадлежит фигура;
2. **color** - цвет фигуры;
3. **place** *(необязательный аргумент)* - поле шахматной доски, на которое
поставить фигуру после создания; значение по умолчанию - **None**;
4. **promoted_from** *(необязательный аргумент)* - ссылка на другую фигуру
(пешку), превращением из которой была создана данная фигура.

### attack_squares()

**Это абстрактный метод, реализуется в подклассах!**

Должен возвращать список [полей](#square), которые фигура может атаковать.

Под атакой имеется в виду, что на этом поле фигура может произвести взятие,
либо могла бы, если бы на этом поле стояла фигура противоположного цвета.

При генерации ходов в этом методе не делается проверка на шах,
то есть допустимы ходы, которые оставляют своего короля под шахом.

### capture_free_moves()

**Это абстрактный метод, реализуется в подклассах!**

Должен возвращать список [полей](#square), на которые фигура может перейти из
текущей позиции без взятия.

При генерации ходов в этом методе не делается проверка на шах,
то есть допустимы ходы, которые оставляют своего короля под шахом.

### captures()

**Это абстрактный метод, реализуется в подклассах!**

Должен возвращать список [полей](#square), на которых фигура может совершить
взятие из текущий позиции.

При генерации ходов в этом методе не делается проверка на шах,
то есть допустимы ходы, которые оставляют своего короля под шахом.

### is_bishop()

Возвращает истину, если фигура является слоном, иначе - ложь.

Этот метод может быть переопределён в подклассах, а в классе Piece всегда
возвращает ложь.

### is_black()

Возвращает истину, если фигура - чёрная, иначе - ложь.

### is_king()

Возвращает истину, если фигура является королём, иначе - ложь.

Этот метод может быть переопределён в подклассах, а в классе Piece всегда
возвращает ложь.

### is_knight()

Возвращает истину, если фигура является конём, иначе - ложь.

Этот метод может быть переопределён в подклассах, а в классе Piece всегда
возвращает ложь.

### is_offboard()

Возвращает истину, если фигура находится вне доски, иначе - ложь.

Изначально фигура находится вне доски (если только при её создании не был
задан аргумент **place**), а ставится на доску вызовом метода
[put_at()](#put_atplace). Фигура может быть убрана с доски вызовом метода
[remove()](#remove). Кроме того, вызов метода [move_back()](#move_back) может
вернуть убранную с доски фигуру обратно на доску.

### is_onboard()

Возвращает истину, если фигура находится на доске, иначе - ложь.

Изначально фигура находится вне доски (если только при её создании не был
задан аргумент **place**), а ставится на доску вызовом метода
[put_at()](#put_atplace). Фигура может быть убрана с доски вызовом метода
[remove()](#remove). Кроме того, вызов метода [move_back()](#move_back) может
вернуть убранную с доски фигуру обратно на доску.

### is_pawn()

Возвращает истину, если фигура является пешкой, иначе - ложь.

Этот метод может быть переопределён в подклассах, а в классе Piece всегда
возвращает ложь.

### is_queen()

Возвращает истину, если фигура является ферзём, иначе - ложь.

Этот метод может быть переопределён в подклассах, а в классе Piece всегда
возвращает ложь.

### is_rook()

Возвращает истину, если фигура является ладьёй, иначе - ложь.

Этот метод может быть переопределён в подклассах, а в классе Piece всегда
возвращает ложь.

### is_white()

Возвращает истину, если фигура - белая, иначе - ложь.

### move_back()

Передвигает фигуру обратно на предыдущее поле.

Если фигура ещё не ходила - выбрасывает исключение.

Удаляет последнее значение из списка **former_squares**.

Обновляет атрибут **place_at**.

Если фигура стояла на доске - обновляет атрибут **piece** того [поля](#square),
на котом стояла фигура; а также обновляет атрибут **piece** поля, на которое
она вернулась.

### move_to(new_place)

Передвигает фигуру на другое поле.

Аргументы:

**new_place** - поле, на которое передвинуть фигуру. Может указывать на любое
поле доски. **Правильность и допустимость хода в этом методе не проверяется!**

Описание:

**new_place** может быть как ссылкой на объект класса [Square](#square), так и
строкой с координатами поля (например "e5" или "D7").

Если фигура находится вне доски - выбрасывается исключение. Также исключение
выбрасывается, если поле назначения совпадает с текущим полем, на котором
стоит фигура.

Если на поле **new_place** стоит другая фигура - она убирается с доски (путём
вызова метода [remove()](#remove)).

Обновляет атрибут **place_at**.

Обновляет атрибуты **piece** того [поля](#square), на котом стояла фигура, и
того, на которое она переместилась.

Добавляет поле на котором стояла фигура в список **former_squares**.

### put_at(place)

Ставит фигуру на доску.

Аргументы:

**place** - поле, на которое поставить фигуру.

Описание:

**place** может быть как ссылкой на объект класса [Square](#square), так и
строкой с координатами поля (например "g6" или "C3").

Если фигура уже находится на доске - выбрасывается исключение. Также исключение
выбрасывается, если на поле **place** стоит другая фигура.

Обнуляет атрибут **former_squares**.

Обновляет атрибут **place_at**.

Обновляет атрибут **piece** того [поля](#square), на которое ставят фигуру.

### remove()

Убирает фигуру с доски.

Если фигура не на доске - выбрасывает исключение.

Обновляет список полей **former_squares**, добавляя в него поле, на котором
стояла фигура.

Значение атрибута **place_at** меняет на **None**.

Значение атрибута **piece** того [квадрата](#square), на котором стояла
фигура, меняет на **None**.

### valid_moves()

**Это абстрактный метод, реализуется в подклассах!**

Должен возвращать список всех [полей](#square), на которые фигура может
перейти из текущей позиции.

При генерации ходов в этом методе не делается проверка на шах,
то есть допустимы ходы, которые оставляют своего короля под шахом.

## Square

Поле шахматной доски.

Поле может находиться за пределами шахматной доски, если при его создании были
даны координаты **file_index** и/или **rank_index** за пределами диапазона 0-7.

"Виртуальные" поля за краем доски нужны для упрощения генерации ходов
шахматных фигур. У таких полей есть ряд особенностей: отсутствие буквы и
номера, невозможность поставить на него фигуру, подробнее смотри ниже.

### Атрибуты Square

* **all_squares** - ссылка на [все поля доски](#squares), необходима для
реализации свойств **down**, **left**, **right**, **up**.
* **color** - цвет поля, вычисляется, исходя из координат поля.
* **down** - ссылка на квадрат, находящийся под текущим.
* **file** - буква поля (a-h). Если поле находится за левым или правым краем
доски, значение этого свойства должно быть **None**.
* **file_index** - индекс столбца, который был указан при создании поля.
* **left** - ссылка на квадрат, находящийся слева от текущего.
* **piece** - ссылка на стоящую на поле фигуру. Если поле пустое - значение
этого свойства должно быть **None**. При попытке поставить фигуру на поле,
находящееся за краем доски должно выбрасываться исключение.
* **rank** - номер поля (1-8). Если поле находится за верхним или нижним краем
доски, значение этого свойства должно быть **None**.
* **rank_index** - индекс строки, который был указан при создании поля.
* **right** - ссылка на квадрат, находящийся справа от текущего.
* **up** - ссылка на квадрат, находящийся над текущим.

### Конструктор Square

Аргументы:

1. **all_squares** - объект класса [Squares](#squares), все поля доски;
2. **file_index** - индекс столбца в котором находится поле;
3. **rank_index** - индекс строки в которой находится поле.

### Методы Square

* **is_downmost()** - возвращает истину, если поле находится в самой нижней
горизонтали (1), иначе - ложь;
* **is_empty()** - возвращает истину, если на поле стоит фигура, иначе - ложь;
* **is_leftmost()** - возвращает истину, если поле находится в самой левой вертикали (a), иначе - ложь;
* **is_off_board()** - возвращает истину, если это "виртуальное" поле,
расположеное за пределами доски, иначе ложь;
* **is_on_board()** - возвращает истину, если поле расположено в пределах
доски, иначе ложь;
* **is_rightmost()** - возвращает истину, если поле находится в самой правой вертикали (h), иначе - ложь;
* **is_topmost()** - возвращает истину, если поле находится в самой верхней
горизонтали (8), иначе - ложь.

## Squares

Все поля шахматной доски.

Этот класс реализует интерфейс последовательности и нужен для упрощения
доступа к полям шахматной доски.

Внутри данные могут храниться, к примеру, в виде двумерного списка (8x8)
[полей](#square). При запросе поля за пределами доски - нужно его создать и
отдать (это не ошибка), но во внутреннее хранилище - не добавлять.

Реализовать нужно следующие методы:

### `__bool__`

Должен возвращать ложь, когда доска пустая (на ней нет ни одной фигуры).
Если на доске стоит хотя бы одна фигура - возвращает истину.

<https://docs.python.org/3/reference/datamodel.html#object.__bool__>

### `__getattr__`

Обработчик доступа к атрибуту объекта. Нужен, чтобы работал такой код:

    square = board.squares.e4
    board.square.D5.is_empty()

Возвращает поле при получении координат от a1 до h8, в остальных случаях
выбрасывает **AttributeError**.

<https://docs.python.org/3/reference/datamodel.html#object.__getattr__>

### `__getitem__`

Обработчик взятия элемента по индексу. Нужен, чтобы работал такой код:

    board.squares["f6"]
    board.squares["a1,c3,e8"]
    board.squares[3][6]

Необходимо, чтобы работали, как минимум, три показанных выше варианта
получения полей:

1. Строка с координатами одного поля (например, "f6"). Возвращается одно поле.
2. Строка со списком координат через запятую. Возвращается список полей.
3. Число - индекс столбца. Возвращается список полей соответствующего столбца:
0 - список полей от a1 до a8, 1 - список полей от b1 до b8, и так далее.
`board.squares[3][6]` в примере выше соответствует полю d7.

<https://docs.python.org/3/reference/datamodel.html#object.__getitem__>

### `__init__`

Конструктор, инициализирует внутреннее хранилище.

<https://docs.python.org/3/reference/datamodel.html#object.__init__>

### `__iter__`

Итератор, можно вернуть генератор, итерирующий все поля во внутреннем
хранилище (от a1 до h8).

Нужен, чтобы работал код типа:

    for square in board.squares:
        # делаем что-то с полями...

<https://docs.python.org/3/reference/datamodel.html#object.__iter__>

### `__len__`

Всегда возвращает 64 (количество полей на доске).

<https://docs.python.org/3/reference/datamodel.html#object.__len__>
